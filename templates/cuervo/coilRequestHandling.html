{% extends "base.html" %}
{% load static %}
{% block stylesheets %}  <link href="/static/css/crud.css" rel="stylesheet">
<style>
    .invisible2 {
    background: transparent;
    border: none !important;
    font-size:0;
    }
</style>
{% endblock stylesheets %}

{% block content %}
{% if user.is_authenticated %}
<div class="container">
	<h1 style="color: white; margin-bottom: 30px">Aprobación/Rechazo de Solicitudes <span class="btn btn-info btn-sm" data-toggle="modal" data-target="#instruccionesModal">?</span></h1>
	<table class="table" id="myTable">
		<thead style="background-color: #1e264e">
			<tr>
				<th scope="col">No. Solicitud</th>
				<th scope="col">Orden</th>
                <th scope="col">Lote</th>
                <th scope="col">Fecha de emisión</th>
                <th scope="col">Cantidad</th>
                 <th scope="col">Creada por</th>
                 <th scope="col">Administrada por</th>
                <th scope="col">Estatus</th>
                {% if perms.cuervo.change_label %}
				<th scope="col">Bobinas</th>
				<th scope="col">Aceptar</th>{% endif %}
			</tr>
		</thead>
		<tbody>
		{% for i in statusList %}
			<tr>
                <td>{{ i.id }}</td>
                <td>{{ i.FK_order_id.uniqueid }}</td>
                <td>{{ i.FK_lot_id.lot }}</td>
                <td>{{ i.request_date }}</td>
                <td>{{ i.total_number }}</td>
                <td>{{ i.created_by }}</td>
                <td>{{ i.accepted_by }}</td>
                <td>{{ i.FK_coil_request_status_id.status }}</td>
				 {% if perms.cuervo.change_coil_request %}
                <form role="form" method="post" action="{% url 'view-coils' i.id %}">
                    {% csrf_token %}
                    <td><button type="submit"><a>VER BOBINAS</a></button></td>
                </form>
                <form role="form" method="post" action="{% url 'accept-coilrequest' i.id %}">
                    {% csrf_token %}
                    <td><button type="submit" class="invisible2"><a><span><img class="img" src="{% static 'media/check.webp' %}"/></span></a></button></td>
                </form>
                {% endif %}
            </tr>
		{% endfor %}
		</tbody>
	</table>
</div>
{% else %}
 <div class="w3-panel w3-yellow">
            <h3 style="color: white">No has iniciado seccion!</h3>
            <p style="color: white">Por favor acceda al siguiente <a href="{% url 'login' %}" class="create">Link</a> para iniciar seccion</p>
        </div>
{% endif %}

<!-- Modal -->
<div class="modal fade" id="instruccionesModal" tabindex="-1" aria-labelledby="instruccionesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="instruccionesModalLabel">Instrucciones</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p><b>Objetivo:</b> Validar que las bobinas solicitadas sean correctas conforme al plan de de la orden de producción y aceptar la orden.</p>
		<p><b>Requisitos:</b> Carga previa de los marbetes pertenecientes a cada bobina, archivo de carga con el correcto formato.</p>
                <p><b>Paso 1:</b> Validar que haya bobinas pendientes.</p>
                <p><b>Paso 2:</b> Ingresar a ver las bobinas de la solicitud pendiente.</p>
                <p><b>Paso 3:</b> Validar de acuerdo con la orden de producción sean las bobinas correctas.</p>
                <p><b>Paso 4:</b> Una vez validadas las bobinas aceptar la solicitud, si la solicitud es incorrecta pasar el dato a controladoras para que la editen.</p>
		<p><b>IMPORTANTE:</b> Si se acepta la solicitud ya no se podrá editar ni eliminar.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

{% endblock content %}

{% block javascripts %}
<script>
        $(document).ready(function () {
            var table = $('#myTable').DataTable({
                "pageLength": 5,
                "lengthMenu": [5, 10]
            });
            generateBarcodes();
        });
    </script>
{% endblock javascripts %}